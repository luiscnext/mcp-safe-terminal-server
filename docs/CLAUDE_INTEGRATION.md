# üîå Claude Desktop Integration Guide\n\nThis guide explains how to integrate the Safe Terminal MCP Server with Claude Desktop for secure terminal access.\n\n## Prerequisites\n\n- Claude Desktop installed and configured\n- Safe Terminal MCP Server built and tested\n- Node.js 18+ available in your PATH\n\n## Step 1: Locate Claude Desktop Configuration\n\nFind your Claude Desktop configuration file:\n\n### macOS\n```bash\n~/Library/Application Support/Claude/claude_desktop_config.json\n```\n\n### Windows\n```bash\n%APPDATA%\\Claude\\claude_desktop_config.json\n```\n\n### Linux\n```bash\n~/.config/Claude/claude_desktop_config.json\n```\n\n## Step 2: Configure the MCP Server\n\nAdd the Safe Terminal server to your Claude Desktop configuration:\n\n```json\n{\n  \"mcpServers\": {\n    \"safe-terminal\": {\n      \"command\": \"node\",\n      \"args\": [\"/absolute/path/to/mcp-safe-terminal-server/dist/index.js\"],\n      \"env\": {\n        \"DEFAULT_WORKING_DIR\": \"/Users/yourname/workspace\",\n        \"ALLOWED_DIRECTORIES\": \"/Users/yourname/workspace,/tmp/safe\",\n        \"LOG_LEVEL\": \"info\",\n        \"MAX_REQUESTS_PER_MINUTE\": \"30\",\n        \"COMMAND_TIMEOUT_MS\": \"10000\",\n        \"ENABLE_GIT_COMMANDS\": \"true\",\n        \"ENABLE_NPM_COMMANDS\": \"true\",\n        \"ENABLE_SYSTEM_INFO\": \"true\"\n      }\n    }\n  }\n}\n```\n\n### Configuration Options Explained\n\n| Option | Description | Security Impact |\n|--------|-------------|----------------|\n| `DEFAULT_WORKING_DIR` | Default directory for command execution | **HIGH** - Limits where commands run |\n| `ALLOWED_DIRECTORIES` | Comma-separated allowed paths | **CRITICAL** - Restricts file system access |\n| `LOG_LEVEL` | Logging verbosity (error, warn, info, debug) | **LOW** - Affects audit detail |\n| `MAX_REQUESTS_PER_MINUTE` | Rate limiting threshold | **MEDIUM** - Prevents abuse |\n| `COMMAND_TIMEOUT_MS` | Maximum command execution time | **MEDIUM** - Prevents resource exhaustion |\n| `ENABLE_*_COMMANDS` | Feature toggles for command categories | **MEDIUM** - Reduces attack surface |\n\n## Step 3: Security Configuration Examples\n\n### Development Environment\n```json\n{\n  \"mcpServers\": {\n    \"safe-terminal-dev\": {\n      \"command\": \"node\",\n      \"args\": [\"/path/to/mcp-safe-terminal-server/dist/index.js\"],\n      \"env\": {\n        \"DEFAULT_WORKING_DIR\": \"/Users/developer/projects\",\n        \"ALLOWED_DIRECTORIES\": \"/Users/developer/projects,/tmp\",\n        \"LOG_LEVEL\": \"debug\",\n        \"MAX_REQUESTS_PER_MINUTE\": \"60\",\n        \"COMMAND_TIMEOUT_MS\": \"15000\",\n        \"ENABLE_GIT_COMMANDS\": \"true\",\n        \"ENABLE_NPM_COMMANDS\": \"true\",\n        \"ENABLE_SYSTEM_INFO\": \"true\"\n      }\n    }\n  }\n}\n```\n\n### Production Environment\n```json\n{\n  \"mcpServers\": {\n    \"safe-terminal-prod\": {\n      \"command\": \"node\",\n      \"args\": [\"/opt/mcp-safe-terminal-server/dist/index.js\"],\n      \"env\": {\n        \"DEFAULT_WORKING_DIR\": \"/var/app/workspace\",\n        \"ALLOWED_DIRECTORIES\": \"/var/app/workspace\",\n        \"LOG_LEVEL\": \"warn\",\n        \"MAX_REQUESTS_PER_MINUTE\": \"10\",\n        \"COMMAND_TIMEOUT_MS\": \"5000\",\n        \"ENABLE_GIT_COMMANDS\": \"true\",\n        \"ENABLE_NPM_COMMANDS\": \"false\",\n        \"ENABLE_SYSTEM_INFO\": \"false\"\n      }\n    }\n  }\n}\n```\n\n### Minimal Security Environment\n```json\n{\n  \"mcpServers\": {\n    \"safe-terminal-minimal\": {\n      \"command\": \"node\",\n      \"args\": [\"/path/to/mcp-safe-terminal-server/dist/index.js\"],\n      \"env\": {\n        \"DEFAULT_WORKING_DIR\": \"/home/user/sandbox\",\n        \"ALLOWED_DIRECTORIES\": \"/home/user/sandbox\",\n        \"LOG_LEVEL\": \"info\",\n        \"MAX_REQUESTS_PER_MINUTE\": \"5\",\n        \"COMMAND_TIMEOUT_MS\": \"3000\",\n        \"ENABLE_GIT_COMMANDS\": \"false\",\n        \"ENABLE_NPM_COMMANDS\": \"false\",\n        \"ENABLE_SYSTEM_INFO\": \"true\"\n      }\n    }\n  }\n}\n```\n\n## Step 4: Test the Integration\n\n1. **Restart Claude Desktop** after configuration changes\n\n2. **Test Basic Commands**:\n   ```\n   Can you list the files in the current directory?\n   ```\n\n3. **Test Security Boundaries**:\n   ```\n   Try to run 'rm -rf /' (this should be blocked)\n   ```\n\n4. **Test Available Commands**:\n   ```\n   What commands are available in the safe terminal?\n   ```\n\n5. **Test Git Operations** (if enabled):\n   ```\n   What's the git status of this repository?\n   ```\n\n## Step 5: Verify Security Settings\n\n### Check Logs\n```bash\n# View server logs\ntail -f /path/to/logs/server.log\n\n# View security audit logs\ntail -f /path/to/logs/audit.log\n```\n\n### Test Security Boundaries\nTry these commands to ensure they're properly blocked:\n\n```bash\n# These should all be blocked:\n- rm -rf /\n- sudo su\n- wget http://malicious-site.com\n- curl -X POST http://external-api.com\n- eval \"dangerous code\"\n- ../../../etc/passwd\n```\n\n## üîí Security Best Practices\n\n### Directory Configuration\n```json\n{\n  \"env\": {\n    // ‚úÖ Good: Specific project directory\n    \"ALLOWED_DIRECTORIES\": \"/Users/dev/safe-projects\",\n    \n    // ‚ùå Avoid: Root or home directory access\n    \"ALLOWED_DIRECTORIES\": \"/,/Users/dev\",\n    \n    // ‚úÖ Good: Multiple specific directories\n    \"ALLOWED_DIRECTORIES\": \"/Users/dev/project1,/Users/dev/project2,/tmp/workspace\"\n  }\n}\n```\n\n### Rate Limiting\n```json\n{\n  \"env\": {\n    // ‚úÖ Conservative for production\n    \"MAX_REQUESTS_PER_MINUTE\": \"10\",\n    \n    // ‚ö†Ô∏è Higher for development\n    \"MAX_REQUESTS_PER_MINUTE\": \"30\",\n    \n    // ‚ùå Too permissive\n    \"MAX_REQUESTS_PER_MINUTE\": \"1000\"\n  }\n}\n```\n\n### Feature Toggles\n```json\n{\n  \"env\": {\n    // ‚úÖ Enable only what you need\n    \"ENABLE_GIT_COMMANDS\": \"true\",\n    \"ENABLE_NPM_COMMANDS\": \"false\",\n    \"ENABLE_SYSTEM_INFO\": \"false\",\n    \n    // ‚ùå Don't enable everything\n    \"ENABLE_GIT_COMMANDS\": \"true\",\n    \"ENABLE_NPM_COMMANDS\": \"true\", \n    \"ENABLE_SYSTEM_INFO\": \"true\"\n  }\n}\n```\n\n## üõ†Ô∏è Troubleshooting\n\n### Common Issues\n\n#### Server Not Starting\n```bash\n# Check if Node.js is accessible\nnode --version\n\n# Verify server builds correctly\ncd /path/to/mcp-safe-terminal-server\nnpm run build\n\n# Test server directly\nnode dist/index.js --help\n```\n\n#### Permission Denied Errors\n```bash\n# Check directory permissions\nls -la /path/to/allowed/directory\n\n# Ensure server has read access\nchmod 755 /path/to/allowed/directory\n```\n\n#### Commands Not Available\n```bash\n# Check which commands are whitelisted\nnode dist/index.js --help\n\n# Verify log output\ntail -f logs/server.log\n```\n\n#### Claude Desktop Not Connecting\n1. Check JSON syntax in configuration file\n2. Restart Claude Desktop\n3. Check system logs for error messages\n4. Verify absolute paths in configuration\n\n### Debug Mode\n\nEnable debug logging for troubleshooting:\n\n```json\n{\n  \"env\": {\n    \"LOG_LEVEL\": \"debug\"\n  }\n}\n```\n\n### Log Analysis\n\n```bash\n# Search for security events\ngrep \"SECURITY\" logs/audit.log\n\n# Monitor command executions\ngrep \"command_executed\" logs/audit.log\n\n# Check for blocked attempts\ngrep \"command_blocked\" logs/audit.log\n```\n\n## üìä Monitoring\n\n### Key Metrics to Watch\n\n1. **Command Execution Rate**: Monitor for unusual spikes\n2. **Blocked Commands**: High numbers may indicate attacks\n3. **Error Rates**: Persistent errors may indicate misconfigurations\n4. **Resource Usage**: CPU/memory consumption patterns\n\n### Alerting Setup\n\n```bash\n# Example: Alert on blocked commands\ngrep \"command_blocked\" logs/audit.log | wc -l\n\n# Example: Monitor rate limit hits\ngrep \"rate_limit_hit\" logs/audit.log | tail -10\n```\n\n## üîÑ Updates and Maintenance\n\n### Regular Tasks\n\n1. **Update Dependencies**: `npm audit && npm update`\n2. **Review Logs**: Check for security events weekly\n3. **Test Security**: Verify blocked commands still blocked\n4. **Backup Configuration**: Keep copies of working configs\n\n### Version Updates\n\n```bash\n# Update to latest version\ngit pull origin main\nnpm install\nnpm run build\n\n# Restart Claude Desktop\n```\n\n## üÜò Emergency Response\n\n### If Security Breach Suspected\n\n1. **Immediately disable the server**:\n   ```json\n   {\n     \"mcpServers\": {}\n   }\n   ```\n\n2. **Analyze logs**:\n   ```bash\n   grep -A5 -B5 \"SECURITY\" logs/audit.log\n   ```\n\n3. **Review command history**:\n   ```bash\n   grep \"command_executed\" logs/audit.log | tail -50\n   ```\n\n4. **Check system integrity**:\n   ```bash\n   # Check for unauthorized changes\n   find /allowed/directories -mtime -1 -type f\n   ```\n\n## üìû Support\n\n- **Documentation**: [GitHub Repository](https://github.com/luiscnext/mcp-safe-terminal-server)\n- **Issues**: [GitHub Issues](https://github.com/luiscnext/mcp-safe-terminal-server/issues)\n- **Security**: See [SECURITY.md](SECURITY.md) for vulnerability reporting\n\n---\n\n**‚ö†Ô∏è Security Reminder**: Always test configuration changes in a safe environment before deploying to production. Monitor logs regularly and keep the server updated.\n